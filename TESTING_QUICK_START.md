# üß™ Testing Quick Start

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
venv/bin/pip install -r requirements-dev.txt
```

## –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã

### Unit —Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä—ã–µ, –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π):
```bash
venv/bin/pytest -v -m unit
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å –ø—Ä–æ–¥–æ–≤—ã–º Redis:
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ .env —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Redis
venv/bin/pytest -v -m "integration and redis"
```

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï):
```bash
venv/bin/pytest -v -m critical -s
```

–≠—Ç–∏ —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç:
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ø—Ä–æ–¥–æ–≤–æ–º—É Redis
- ‚úÖ SSL —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (SET/GET/DELETE)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã (5MB+)
- ‚úÖ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∏–∫–µ—Ä–æ–≤

### –í—Å–µ —Ç–µ—Å—Ç—ã:
```bash
venv/bin/pytest -v
```

### –° coverage –æ—Ç—á–µ—Ç–æ–º:
```bash
venv/bin/pytest --cov=app --cov-report=html
open htmlcov/index.html
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Makefile

```bash
# Unit —Ç–µ—Å—Ç—ã
make test-unit

# Integration —Ç–µ—Å—Ç—ã
make test-integration

# –° coverage
make test-cov

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π Redis –¥–ª—è —Ç–µ—Å—Ç–æ–≤
make redis-local
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ unit/                           # –ë—ã—Å—Ç—Ä—ã–µ, –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ test_converter.py          # 8 —Ç–µ—Å—Ç–æ–≤ - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Å—Ç–∏–∫–µ—Ä–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ test_telegram_service.py   # 8 —Ç–µ—Å—Ç–æ–≤ - Telegram API –ª–æ–≥–∏–∫–∞
‚îÇ
‚îî‚îÄ‚îÄ integration/                    # –¢—Ä–µ–±—É—é—Ç –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
    ‚îú‚îÄ‚îÄ test_redis_integration.py      # 9 —Ç–µ—Å—Ç–æ–≤ - –æ–±—â–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Redis
    ‚îú‚îÄ‚îÄ test_production_redis.py       # üî¥ 9 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤
    ‚îî‚îÄ‚îÄ test_api_endpoints.py          # 4 —Ç–µ—Å—Ç–∞ - FastAPI endpoints
```

**–í—Å–µ–≥–æ: 38 —Ç–µ—Å—Ç–æ–≤**

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ Unit —Ç–µ—Å—Ç—ã (16 —Ç–µ—Å—Ç–æ–≤):
- –í—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ~0.2s
- Coverage: ~42%

### ‚úÖ Integration —Ç–µ—Å—Ç—ã (14 —Ç–µ—Å—Ç–æ–≤):
- –¢—Ä–µ–±—É—é—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è –µ—Å–ª–∏ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã (9 —à—Ç.) - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´ –¥–ª—è –ø—Ä–æ–¥–æ–≤–æ–≥–æ Redis

## –í–∞–∂–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã

- `@pytest.mark.unit` - Unit —Ç–µ—Å—Ç—ã
- `@pytest.mark.integration` - Integration —Ç–µ—Å—Ç—ã
- `@pytest.mark.redis` - –¢—Ä–µ–±—É—é—Ç Redis
- `@pytest.mark.critical` - üî¥ **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï** —Ç–µ—Å—Ç—ã (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´)
- `@pytest.mark.slow` - –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (>1s)

## –ü—Ä–∏–º–µ—Ä—ã

### –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã:
```bash
venv/bin/pytest -v -m critical
```

### –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –∫—Ä–æ–º–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö:
```bash
venv/bin/pytest -v -m "not slow"
```

### –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –≤—ã–≤–æ–¥–æ–º:
```bash
venv/bin/pytest -v -m critical -s
```

–§–ª–∞–≥ `-s` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç print() –≤—ã–≤–æ–¥—ã, –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.

## CI/CD

–î–ª—è CI/CD –ø–∞–π–ø–ª–∞–π–Ω–æ–≤:

```yaml
# –¢–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä—ã–µ)
pytest -m unit --cov=app --cov-report=xml

# –° integration —Ç–µ—Å—Ç–∞–º–∏ (–µ—Å–ª–∏ Redis –¥–æ—Å—Ç—É–ø–µ–Ω)
pytest -m "unit or integration" --cov=app --cov-report=xml
```

## Troubleshooting

### –¢–µ—Å—Ç—ã –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è (SKIPPED)
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –µ—Å–ª–∏ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- Integration —Ç–µ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è –±–µ–∑ Redis

### Redis connection refused
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π Redis
docker run -d -p 6379:6379 redis:7-alpine

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–¥–æ–≤—ã–π Redis (–Ω–∞—Å—Ç—Ä–æ–π—Ç–µ .env)
```

### Import errors
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ venv –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
venv/bin/pytest

# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
venv/bin/pip install -r requirements-dev.txt
```

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π workflow

1. **–ü–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º**:
   ```bash
   make test-unit  # –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
   ```

2. **–ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º**:
   ```bash
   make test  # –í—Å–µ —Ç–µ—Å—Ç—ã
   ```

3. **–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è Redis –Ω–∞—Å—Ç—Ä–æ–µ–∫**:
   ```bash
   venv/bin/pytest -v -m critical  # üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
   ```

4. **–î–ª—è –æ—Ç–ª–∞–¥–∫–∏**:
   ```bash
   pytest -v -s --tb=long tests/unit/test_converter.py::TestConverterService::test_process_sticker_tgs
   ```

